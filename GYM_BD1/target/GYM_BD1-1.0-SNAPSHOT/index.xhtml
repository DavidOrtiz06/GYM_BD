<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>GYM</title>
    <link rel="stylesheet" href="https://unpkg.com/primeflex@latest/primeflex.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
</h:head>

<h:body class="container mt-4" style="max-width: 96%">

    <h:form id="formTabla">
        <p:messages id="msgsSalida" showDetail="false" closable="true"
                    style="position:absolute; top:10px; left:10px; width:450px; z-index:1000;" />
        <div class="card p-4 shadow-lg">

            <div style="display: flex; justify-content: center; align-items: center; gap: 1rem; margin: 20px;">
                <h:outputLabel value="ID Cliente"/>
                <p:inputText id="idVisitante" value="#{clienteBean.idClienteFiltro}" style="width: 200px;">
                    <p:keyFilter mask="num"/>
                </p:inputText>

                <p:commandButton value="Buscar"
                                 action="#{clienteBean.buscarClientes()}"
                                 update="formTabla"
                                 styleClass="ui-button-primary"
                                 icon="pi pi-search"
                                 style="margin-left: 10px;"/>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-3">
                <p:commandButton value="Nuevo Cliente" action="#{clienteBean.crearCliente()}"
                                 icon="pi pi-plus-circle"
                                 styleClass="ui-button-success"
                                 oncomplete="PF('dlgRegistrarCliente').show()"
                                 update=":formRegistro"/>

                <div class="d-flex gap-2">
                    <p:commandButton value="1 Mes"
                                     icon="pi pi-star"
                                     style="background-color: #f1c40f; color: black; border: none;"
                                     actionListener="#{suscripcionBean.seleccionarMeses(1)}"
                                     oncomplete="PF('dlgSuscripcion').show()"
                                     update=":formSuscripcion"/>
                    <p:commandButton value="3 Meses"
                                     icon="pi pi-star"
                                     style="background-color: #f1c40f; color: black; border: none;"
                                     actionListener="#{suscripcionBean.seleccionarMeses(3)}"
                                     oncomplete="PF('dlgSuscripcion').show()"
                                     update=":formSuscripcion"/>
                    <p:commandButton value="6 Meses"
                                     icon="pi pi-star"
                                     style="background-color: #f1c40f; color: black; border: none;"
                                     actionListener="#{suscripcionBean.seleccionarMeses(6)}"
                                     oncomplete="PF('dlgSuscripcion').show()"
                                     update=":formSuscripcion"/>
                    <p:commandButton value="12 Meses"
                                     icon="pi pi-star"
                                     style="background-color: #f1c40f; color: black; border: none;"
                                     actionListener="#{suscripcionBean.seleccionarMeses(12)}"
                                     oncomplete="PF('dlgSuscripcion').show()"
                                     update=":formSuscripcion"/>
                </div>
            </div>

            <p:dataTable var="cliente" value="#{clienteBean.clientesFiltrados}">
                <p:column headerText="Numero Documento">
                    <h:outputText value="#{cliente.numDocumentoCliente}">
                        <f:convertNumber type="number" groupingUsed="true"/>
                    </h:outputText>
                </p:column>

                <p:column headerText="Nombre">
                    <h:outputText value="#{cliente.nombre}"/>
                </p:column>

                <p:column headerText="Correo">
                    <h:outputText value="#{cliente.correo}"/>
                </p:column>

                <p:column headerText="Numero Telefono">
                    <h:outputText value="#{cliente.numTelefono}"/>
                </p:column>

                <p:column headerText="Estado">
                    <h:outputText value="#{cliente.estado}"/>
                </p:column>

                <p:column headerText="Ver Detalles Suscripción">
                    <p:commandButton actionListener="#{clienteBean.setClienteDto(cliente)}"
                                     icon="pi pi-pencil" styleClass="ui-button-warning"
                                     oncomplete="PF('dlgDetalles').show()" update=":formDetalles"/>
                </p:column>
            </p:dataTable>
        </div>
    </h:form>

    <h:form id="formSuscripcion">
        <p:messages id="msgsSuscripcion" showDetail="false" closable="true"
                    style="position:fixed; top:10px; left:10px; width:450px; z-index:1000;" />
        <p:dialog header="Confirmar Suscripción" widgetVar="dlgSuscripcion" modal="true"
                  resizable="false" width="400" closable="false">
            <p:panelGrid columns="1" style="width:100%; text-align:center;">
                <h:outputText value="¿Desea confirmar la suscripción por:" style="font-weight:bold;"/>
                <h:outputText value="#{suscripcionBean.suscripcionDto.meses} Mes(es)" style="font-size:18px; color:#f39c12;"/>
            </p:panelGrid>

            <f:facet name="footer">
                <div class="d-flex justify-content-center gap-2">
                    <p:commandButton value="Confirmar" icon="pi pi-check"
                                     actionListener="#{suscripcionBean.registrarSuscripcion()}"
                                     update=":formTabla, :formSuscripcion"
                                     oncomplete="if (!args.validationFailed) { PF('dlgSuscripcion').hide() }"/>
                    <p:commandButton value="Cancelar" icon="pi pi-times-circle"
                                     styleClass="ui-button-secondary"
                                     onclick="PF('dlgSuscripcion').hide();" type="button"/>
                </div>
            </f:facet>
        </p:dialog>
    </h:form>

    <h:form id="formRegistro">
        <p:messages id="msgsRegistro" showDetail="false" closable="true"
                    style="position:fixed; top:10px; left:10px; width:450px; z-index:1000;" />
        <p:dialog header="Registro Cliente" widgetVar="dlgRegistrarCliente" modal="true"
                  resizable="false" width="550" closable="false">
            <p:panelGrid id="grid" columns="2" style="width:100%;">
                <h:outputLabel for="documentoCliente" value="Número de Documento:"/>
                <p:inputText id="documentoCliente" value="#{clienteBean.clienteDto.numDocumentoCliente}"
                             required="true" requiredMessage="El número de documento es obligatorio">
                    <p:keyFilter mask="num"/>
                </p:inputText>

                <h:outputLabel for="nombreCliente" value="Nombre:"/>
                <p:inputText id="nombreCliente" value="#{clienteBean.clienteDto.nombre}"
                             required="true" requiredMessage="El nombre es obligatorio">
                    <p:keyFilter regEx="/[ABCDEFGHIJKLMNÑOPQRSTUVWXYZ ]/i"/>
                </p:inputText>

                <h:outputLabel for="correoCliente" value="Correo:"/>
                <p:inputText id="correoCliente" value="#{clienteBean.clienteDto.correo}"
                             required="true" requiredMessage="El correo es obligatorio">
                    <p:keyFilter regEx="/[ABCDEFGHIJKLMNÑOPQRSTUVWXYZ 0123456789@_.]/i"/>
                </p:inputText>

                <h:outputLabel for="telefonoCliente" value="Número de Teléfono:"/>
                <p:inputText id="telefonoCliente" value="#{clienteBean.clienteDto.numTelefono}"
                             required="true" requiredMessage="El número de teléfono es obligatorio">
                    <p:keyFilter mask="num"/>
                </p:inputText>
            </p:panelGrid>

            <f:facet name="footer">
                <p:commandButton value="Registrar" action="#{clienteBean.registrarCliente()}"
                                 icon="pi pi-save" styleClass="ui-button-success"
                                 update=":formTabla, formRegistro:grid, formRegistro:msgsRegistro"
                                 oncomplete="if (!args.validationFailed) PF('dlgRegistrarCliente').hide()"/>
                <p:commandButton value="Cancelar"
                                 onclick="PF('dlgRegistrarCliente').hide();"
                                 type="button" icon="pi pi-times-circle"
                                 styleClass="ui-button-secondary"/>
            </f:facet>
        </p:dialog>
    </h:form>

    <h:form id="formDetalles">
        <p:dialog header="Detalle Visitante" widgetVar="dlgDetalles" modal="true" resizable="false" width="550">
            <p:panelGrid columns="2" style="width:100%;">

                <h:outputLabel value="ID Suscripcion:"/>
                <h:outputText value="#{clienteBean.clienteDto.suscripcion.idSuscripcion}"/>

                <h:outputLabel value="Mes(es):"/>
                <h:outputText value="#{clienteBean.clienteDto.suscripcion.meses}"/>

                <h:outputLabel value="Fecha Incio:"/>
                <h:outputText value="#{clienteBean.clienteDto.suscripcion.fechaInicio}">
                    <f:convertDateTime pattern="dd/MM/yyyy" type="localDateTime"/>
                </h:outputText>

                <h:outputLabel value="Fecha Fin:"/>
                <h:outputText value="#{clienteBean.clienteDto.suscripcion.fechaFin}">
                    <f:convertDateTime pattern="dd/MM/yyyy" type="localDateTime"/>
                </h:outputText>

                <h:outputLabel value="Estado:"/>
                <h:outputText value="#{clienteBean.clienteDto.suscripcion.estado}"/>

            </p:panelGrid>

            <f:facet name="footer">
                <p:commandButton value="Cerrar" onclick="PF('dlgDetalles').hide()" type="button"
                                 icon="pi pi-times-circle" styleClass="ui-button-secondary"/>
            </f:facet>
        </p:dialog>
    </h:form>
</h:body>
</html>
